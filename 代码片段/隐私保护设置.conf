# ============================================================================
# 隐私保护设置配置
# 用途: 增强网站安全性，保护敏感文件和目录不被公开访问
# 适用范围: 所有网站服务器配置
# 说明: 此文件应包含在server块中，用于保护关键系统文件和隐私信息
# ============================================================================

# ============================================================================
# 一、隐藏文件保护
# ============================================================================

# ---------------------------------------------------------------------------
# 隐藏文件保护 - 允许.well-known目录
# ---------------------------------------------------------------------------
# 允许访问.well-known目录（用于证书验证等）
location ~ /\.well-known {
    allow all;
    try_files $uri $uri/ =404;
}

# 禁止访问其他以点开头的隐藏文件
# 匹配规则: location ~ /\.(?!well-known) {}
# 正则表达式解释:
# - ~: 启用正则表达式匹配模式(区分大小写)
# - /\.(?!well-known): 匹配任何以斜杠和点开头但不是.well-known的路径
# 
# 保护对象包括:
# - .htaccess、.htpasswd: Apache配置文件，可能包含访问控制信息
# - .git、.svn、.hg: 版本控制系统目录，可能包含完整源代码和配置信息
# - .env、.config: 环境配置文件，通常包含数据库凭证和API密钥
# - .DS_Store、Thumbs.db: 操作系统生成的文件，可能泄露目录结构
# - .bashrc、.profile: shell配置文件，可能包含服务器信息
# 
# 安全重要性:
# - 防止泄露敏感配置信息
# - 避免暴露网站源代码和内部结构
# - 保护数据库凭证和其他密钥不被未授权访问
# - 符合OWASP安全最佳实践
# 
# 执行操作: deny all
# - 返回403 Forbidden状态码
# - 完全阻止任何对匹配路径的访问尝试
# - 不返回任何内容给客户端
location ~ /\.(?!well-known) {
    deny all;
}

# ============================================================================
# 二、可选的隐私保护扩展配置
# ============================================================================

# ---------------------------------------------------------------------------
# 1. 保护临时文件目录
# ---------------------------------------------------------------------------
# 禁止访问常见的临时文件目录
# 这些目录通常包含临时文件、上传文件或会话数据
#
# location ~ /(tmp|temp|cache|sessions|uploads|backup|backups)/ {
#     deny all;
# }

# ---------------------------------------------------------------------------
# 2. 保护配置文件目录
# ---------------------------------------------------------------------------
# 禁止直接访问配置文件目录
# 适用于包含网站配置的专用目录
#
# location ~ /(config|conf|includes|includes\.d)/ {
#     deny all;
# }

# ---------------------------------------------------------------------------
# 3. 保护日志文件
# ---------------------------------------------------------------------------
# 防止日志文件被公开访问，这些文件可能包含敏感信息
#
# location ~ \.(log|sql|tar|gz|zip|rar|bak)$ {
#     deny all;
# }

# ---------------------------------------------------------------------------
# 4. 保护备份文件
# ---------------------------------------------------------------------------
# 防止备份文件被访问，这些文件通常包含完整的数据库或网站内容
#
# location ~ \.(bak|backup|old|orig|save|swp|swo|~)$ {
#     deny all;
# }

# ---------------------------------------------------------------------------
# 5. 限制对.git目录的访问(更具体的保护)
# ---------------------------------------------------------------------------
# 专门保护Git版本控制目录，防止源码泄露
#
# location ~ /\.git {
#     deny all;
# }

# ============================================================================
# 隐私保护最佳实践
# ============================================================================
# 1. 配置定期扫描:
#    - 使用自动化工具定期扫描网站，检测可访问的敏感文件
#    - 监控服务器日志中的异常访问模式
#
# 2. 文件权限设置:
#    - 除了Nginx访问控制外，确保文件系统权限正确设置
#    - 关键配置文件应设置为600(仅所有者可读写)
#    - 敏感目录应设置为700(仅所有者可访问)
#
# 3. 安全响应头:
#    - 考虑添加安全响应头增强隐私保护
#    - 例如Referrer-Policy、Cache-Control等
#
# 4. 安全审计:
#    - 定期审查网站目录，移除不必要的敏感文件
#    - 确保没有备份文件、配置文件或临时文件暴露在网站根目录下
#
# 5. Web应用防火墙(WAF):
#    - 考虑部署WAF提供额外的保护层
#    - 可以阻止针对敏感文件的探测和攻击
#
# 6. 错误页面处理:
#    - 自定义403和404错误页面，避免泄露服务器信息
#    - 配置示例: error_page 403 /403.html;
#
# 7. 内容安全策略(CSP):
#    - 实施严格的CSP，限制资源加载来源
#    - 可以防止XSS攻击，间接保护用户隐私
#
# 注意: 请根据实际网站结构和需求选择并启用适当的保护措施。某些目录可能需要被特定应用程序访问，
#       启用前请确保不会影响正常功能。