# ============================================================
# 通用CORS配置 - 允许相同一级域名的跨域访问
# 可在不同站点配置中复用，无需修改域名
# ============================================================

# 静态资源CORS配置 - 直接在server块中使用
location ~* \.(mp4|m3u8|ts|js|css|jpg|jpeg|png|gif|ico|svg|woff|woff2|ttf|eot)$ {
    # 检查是否存在Origin头
    if ($http_origin != "") {
        # 允许所有来源的跨域访问
        # 注意：在生产环境中，应该根据需要限制来源
        add_header Access-Control-Allow-Origin $http_origin;
        add_header Access-Control-Allow-Methods 'GET, POST, OPTIONS';
        add_header Access-Control-Allow-Headers 'DNT,X-Mx-ReqToken,Keep-Alive,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Range';
        add_header Access-Control-Allow-Credentials 'true';
    }
    
    # 处理预检请求
    if ($request_method = 'OPTIONS') {
        return 204;
    }
}

# ============================================================
# 使用说明：
# 1. 在需要CORS支持的server块中包含此文件：include /etc/nginx/代码片段/通用CORS设置.conf;
# 2. 此配置会检查请求的Origin头，并允许跨域访问
# 3. 支持http和https协议
# 4. 支持任意子域名和主域名
# ============================================================