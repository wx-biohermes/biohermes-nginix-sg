server {
    listen 443 ssl;
    server_name libs.biohermes.com;

    root /var/www/libs.biohermes.com;
    index index.html index.htm;

    include /etc/nginx/snippets/privacy.conf;

    # 为所有请求添加CORS头，使用always确保所有响应都包含这些头
    add_header Access-Control-Allow-Origin "*" always;
    add_header Access-Control-Allow-Methods "GET, OPTIONS" always;
    add_header Access-Control-Allow-Headers "Origin, X-Requested-With, Content-Type, Accept" always;
    add_header Access-Control-Max-Age 86400 always;

    # 专门针对静态资源加强CORS配置
    location ~* \.(css|js|jsx|png|jpg|jpeg|gif|ico|svg|woff|woff2|ttf|eot)$ {
        add_header Access-Control-Allow-Origin "*" always;
        add_header Access-Control-Allow-Methods "GET, OPTIONS" always;
        expires 1d;
        add_header Cache-Control "public, max-age=86400";
    }

    # 处理预检请求
    location / {
        if ($request_method = 'OPTIONS') {
            return 204;
        }
    }
    ssl_certificate /etc/letsencrypt/live/phpmyadmin-sg.biohermes.com/fullchain.pem; # managed by Certbot
    ssl_certificate_key /etc/letsencrypt/live/phpmyadmin-sg.biohermes.com/privkey.pem; # managed by Certbot
    include /etc/letsencrypt/options-ssl-nginx.conf; # managed by Certbot
    ssl_dhparam /etc/letsencrypt/ssl-dhparams.pem; # managed by Certbot

    # 单独记录404错误日志 - 使用error_log记录错误信息
    error_log /var/log/nginx/libs.biohermes.com-404.log notice;   

}

server {
    if ($host = libs.biohermes.com) {
        return 301 https://$host$request_uri;
    } # managed by Certbot

    listen 80;
    server_name libs.biohermes.com;
    return 404; # managed by Certbot
}